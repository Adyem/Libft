# Encryption key management guide

This guide summarizes the practices the project follows when generating,
rotating, and storing cryptographic keys. The helper functions introduced in
`Encryption/encryption_key_management.hpp` are available to automate the
high-risk steps.

## Generating new material

Use `encryption_generate_symmetric_key` to allocate a CMA-backed buffer that is
immediately filled with cryptographically secure random bytes. The helper
returns `ft_nullptr` and propagates `ft_errno` if the platform RNG reports an
error. When a fixed-size buffer already exists, call
`encryption_fill_secure_buffer` to rewrite it with fresh entropy instead of
recycling prior material. Initialization vectors for block modes are produced by
`encryption_generate_initialization_vector`, which delegates to the same secure
random source.

### Sample workflow

```c++
size_t key_length = 32;
unsigned char *session_key = encryption_generate_symmetric_key(key_length);
if (session_key == ft_nullptr)
    handle_error(ft_errno);
unsigned char *session_iv = encryption_generate_initialization_vector(16);
if (session_iv == ft_nullptr)
{
    encryption_secure_wipe(session_key, key_length);
    cma_free(session_key);
    handle_error(ft_errno);
}
```

## Storage and rotation

Store the generated bytes encrypted at rest and scope filesystem permissions so
only the services that require the material can access it. Rotate credentials on
a predictable cadence (for example, monthly) and immediately after any
suspicious activity. When replacing a key, issue a fresh initialization vector
for every message or session and prefer authenticated key-exchange protocols
(such as mutually authenticated Diffie-Hellman) instead of shipping long-lived
secrets in configuration files.

## Sanitizing sensitive buffers

Every buffer returned by the helpers must be wiped before release. Call
`encryption_secure_wipe` to zero the bytes and `cma_free` to return the
allocation to the allocator. This ensures sensitive material does not linger in
heap arenas after use.
